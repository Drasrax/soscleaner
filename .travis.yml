language: python
python:
- '2.7'
env:
  global:
  - COPR_REPOSITORY=soscleaner
  - OS_ARCH=x86_64
  - DOCKER_IMAGE=alectolytic/rpmbuilder
  - SOSCLEANER_VERSION=$(grep current_version setup.cfg | cut -d \= -f 2)
  - TRAVIS_TAG=${$(grep current_version setup.cfg | cut -d \= -f 2)-$(date +'%Y%m%d%H%M%S')-$(git
    log --format=%h -1)}
  matrix:
  - OS_TYPE=centos OS_DIST=epel OS_VERSION=7 OS_SLUG=el7
services:
- docker
before_install:
- openssl aes-256-cbc -K $encrypted_447a8e6ecb5b_key -iv $encrypted_447a8e6ecb5b_iv -in .copr.enc -out .copr -d
install:
- pip install -r requirements.txt
script:
- nosetests --with-coverage
after_success:
- coveralls
- docker run -v ${PWD}:/sources -v ${PWD}:/output:Z -e "SRPM_ONLY=1" ${DOCKER_IMAGE}:${OS_TYPE}-${OS_VERSION}
- copr-cli --config .copr build -r ${OS_DIST}-${OS_VERSION}-${OS_ARCH} ${COPR_REPOSITORY}
  ${COPR_REPOSITORY}-${SOSCLEANER_VERSION}-1.${OS_SLUG}.src.rpm
deploy:
  provider: releases
  api_key:
    secure: l0bTCrj8HmWRrZfyA90KjOFHPk641dCCN9HxPG72f7ExY4PdUP6nz3gKYTUJKaEV8Lpk+kPU0gv5qk1nG+v1w7VE8UkTHsd2eoYfbrko3/RBjSjHjFR9vBuhfsEPc0sf9OAGwjL9mAUHgmKprLkPBoV60KvjfMA5VYmM3brcdcMhPl94lXDm6WnQBqftkM0ef9K0SLZRMqKKeWFQ+6IuW4vw/+K0G+Fp5hOlSdSKO9CIL+xHLBLN+xgF0gseH0PXfOQ33peURwokGvB8H38BOuZ/iQriwFm7YCt33g0o2+RJHntxydbN5x2KT5VIzbH9QDLpRgznt8X5FLro3lQmyl0llLlNaJQvlBSbp20QGUgna6gSWFb/+iMcW3I9IsW5aTlFAvM+av6bAjRHWhTL8LSHyqEc8yPVd2obW7mJmHu6bMXcqfvAFSE0wk/pGE3KgsnHm9Ihi1957CMPm/8HqE2ph5Zzop1+8jH/iZcKxzhXugcE/KtoMSl7wsoUzrgTMsHVni9MprXQOgl2DDmS7batroOhMP7nWOYBF7uE8Z4V0R/NBLB6GcbdoYGq9MFDqEDXdmTM2Ouf+bRHpQLjziCWNHqq3ueZ7rbyD8IMhRLXxDeDf+kC81Vb6W9FrfCOmDoHu71HTD27ae6ZA3xxoHAvs0+x6w+upZo48tB+MuU=
  file: soscleaner.tar.gz
  on:
    repo: jduncan-rva/soscleaner
